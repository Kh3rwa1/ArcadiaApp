<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Star Runner | Arcadia</title>
    <style>
        :root {
            --void: #000000;
            --obsidian: #040405;
            --accent: #3B82F6;
            --text: #F9FAFB;
        }

        body {
            margin: 0;
            padding: 0;
            background: var(--void);
            color: var(--text);
            font-family: 'Inter', -apple-system, sans-serif;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            touch-action: none;
        }

        #ui {
            position: absolute;
            top: 60px;
            left: 24px;
            pointer-events: none;
        }

        #score {
            font-size: 32px;
            font-weight: 800;
            letter-spacing: -1px;
        }

        #start-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        h1 {
            font-size: 40px;
            font-weight: 900;
            margin-bottom: 8px;
            letter-spacing: -2px;
        }

        p {
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 32px;
        }

        .btn {
            background: var(--text);
            color: var(--void);
            padding: 16px 48px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 18px;
            border: none;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div id="ui">
        <div id="score">000</div>
    </div>

    <div id="start-overlay">
        <h1>Star Runner</h1>
        <p>Tap to jump over cosmic debris</p>
        <button class="btn" id="start-btn">ENGAGE</button>
    </div>

    <canvas id="game"></canvas>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const startOverlay = document.getElementById('start-overlay');
        const startBtn = document.getElementById('start-btn');

        let width, height;
        let playing = false;
        let score = 0;
        let player = { x: 50, y: 0, w: 30, h: 30, vy: 0, jump: -12 };
        let obstacles = [];
        let stars = [];
        let frame = 0;

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            player.y = height * 0.7;
        }

        window.addEventListener('resize', resize);
        resize();

        // Create stars
        for (let i = 0; i < 50; i++) {
            stars.push({
                x: Math.random() * width,
                y: Math.random() * height,
                s: Math.random() * 2 + 1,
                v: Math.random() * 2 + 1
            });
        }

        function post(type, action, payload = {}) {
            if (window.ReactNativeWebView) {
                window.ReactNativeWebView.postMessage(JSON.stringify({
                    version: "1.0",
                    type,
                    action,
                    payload
                }));
            }
        }

        // Send ready signal
        post("LIFECYCLE", "READY", { engine: "vanilla_js" });

        function jump() {
            if (!playing) return;
            if (player.y === height * 0.7) {
                player.vy = player.jump;
            }
        }

        window.addEventListener('touchstart', jump);
        window.addEventListener('mousedown', jump);

        startBtn.onclick = (e) => {
            e.stopPropagation();
            playing = true;
            startOverlay.style.display = 'none';
            score = 0;
            obstacles = [];
            post("GAMEPLAY", "GAME_START");
        };

        function update() {
            if (!playing) return;

            frame++;
            if (frame % 100 === 0) {
                obstacles.push({ x: width, y: height * 0.7, w: 40, h: 40, speed: 5 + (score / 100) });
            }

            // Move stars
            stars.forEach(s => {
                s.x -= s.v;
                if (s.x < 0) s.x = width;
            });

            // Move player
            player.vy += 0.6; // gravity
            player.y += player.vy;
            if (player.y > height * 0.7) {
                player.y = height * 0.7;
                player.vy = 0;
            }

            // Move obstacles
            obstacles.forEach((o, i) => {
                o.x -= o.speed;

                // Collision
                if (player.x < o.x + o.w && player.x + player.w > o.x && player.y < o.y + o.h && player.y + player.h > o.y) {
                    gameOver();
                }

                if (o.x + o.w < 0) {
                    obstacles.splice(i, 1);
                    score += 10;
                    scoreEl.innerText = score.toString().padStart(3, '0');
                    post("GAMEPLAY", "SCORE_UPDATE", { score });
                }
            });
        }

        function draw() {
            ctx.clearRect(0, 0, width, height);

            // Draw stars
            ctx.fillStyle = '#FFFFFF';
            stars.forEach(s => {
                ctx.globalAlpha = 0.5;
                ctx.fillRect(s.x, s.y, s.s, s.s);
            });
            ctx.globalAlpha = 1.0;

            // Draw ground line
            ctx.strokeStyle = 'rgba(255,255,255,0.1)';
            ctx.beginPath();
            ctx.moveTo(0, height * 0.7 + 30);
            ctx.lineTo(width, height * 0.7 + 30);
            ctx.stroke();

            // Draw player
            ctx.fillStyle = '#3B82F6';
            ctx.shadowBlur = 15;
            ctx.shadowColor = '#3B82F6';
            ctx.fillRect(player.x, player.y, player.w, player.h);
            ctx.shadowBlur = 0;

            // Draw obstacles
            ctx.fillStyle = '#ef4444';
            obstacles.forEach(o => {
                ctx.fillRect(o.x, o.y, o.w, o.h);
            });

            requestAnimationFrame(() => {
                update();
                draw();
            });
        }

        function gameOver() {
            playing = false;
            post("GAMEPLAY", "GAME_COMPLETE", { score, status: "loss" });
            startOverlay.style.display = 'flex';
            startOverlay.querySelector('h1').innerText = "SYSTEM FAILURE";
            startOverlay.querySelector('p').innerText = `Your journey ended at ${score} lightyears`;
            startBtn.innerText = "REBOOT";
        }

        // Listen for pause/resume from App
        window.addEventListener('ArcadiaBridge', (e) => {
            const { action } = e.detail;
            if (action === 'LIFECYCLE_PAUSE') playing = false;
            if (action === 'LIFECYCLE_RESUME' && startOverlay.style.display === 'none') playing = true;
        });

        draw();
    </script>
</body>

</html>